import streamlit as st
import pandas as pd
import tempfile
import base64
from collections import Counter
from itertools import combinations
import random

st.set_page_config(layout="wide")
st.markdown(
    """
    <style>
    /* Odsazení celého hlavního obsahu od horního okraje */
    main > div:has(.block-container) {
        padding-top: 60px;
    }
    .stApp {
        background-image: url('https://img41.rajce.idnes.cz/d4102/19/19642/19642596_185bd55429092dbd5dccd20ff2c485cb/images/card_back_texture.jpg?ver=0');
        background-repeat: repeat;
        background-size: 100px 100px;
        background-attachment: fixed;
        font-family: 'Segoe UI', sans-serif;
    }

    /* Pozadí hlavního kontejneru – textura papíru */
    .block-container {
        background-image: url('https://img41.rajce.idnes.cz/d4102/19/19642/19642596_185bd55429092dbd5dccd20ff2c485cb/images/paper.jpg?ver=0');
        background-repeat: repeat;
        background-size: 300px 300px;
        background-color: rgba(255, 255, 255, 0.75);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h1 {
        margin-top: 0px;
        text-align: left;
        color: #2c2c2c;
        text-shadow: 1px 1px 1px #fff9;
    }

    h2, h3 {
        color: #2c2c2c;
        text-shadow: 1px 1px 1px #fff9;
    }
        /* Obal vstupních polí – zarovnání na střed */
        .param-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        /* Šířka všech vstupních polí */
        .param-container .stNumberInput, 
        .param-container div[data-baseweb="select"] {
            width: 300px !important;
        }


    .stTextInput, .stNumberInput, .stSelectbox {
        background-color: #ffffffcc;
        border-radius: 8px;
    }

    button[kind="primary"] {
        background-color: #8b5e3c;
        color: white;
        border-radius: 8px;
        border: none;
        padding: 0.5rem 1.5rem;
        font-weight: bold;
    }

    button[kind="primary"]:hover {
        background-color: #5c3a1e;
    }
    </style>
    """,
    unsafe_allow_html=True
)

st.title("Rozlosování a evidence mariášového turnaje")

# ===== SEATING DEFINITIONS =====
SEATING_DEFINITIONS = {
    # 3členné skupiny
    '9_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(9)) - ověřeno",
        'rounds': [
            [[1,2,3], [4,5,6], [7,8,9]],
            [[1,4,7], [2,5,8], [3,6,9]],
            [[1,5,9], [2,6,7], [3,4,8]],
            [[1,6,8], [2,4,9], [3,5,7]]
        ]
    },
    '12_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(12)) - ověřeno",
        'rounds': [
            [[1,2,3], [4,5,6], [7,8,9], [10,11,12]],
            [[1,4,10], [5,7,11], [2,6,8], [3,9,12]],
            [[1,5,9], [4,8,12], [2,7,10], [3,6,11]],
            [[2,5,12], [1,8,11], [4,7,3], [10,6,9]]
        ]
    },
    '15_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(15)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15]],
            [[1,4,7],[2,5,10],[3,6,13],[8,11,14],[9,12,15]],
            [[1,5,14],[2,4,15],[3,8,12],[6,9,11],[7,10,13]],
            [[1,9,13],[2,7,12],[3,4,11],[5,8,15],[6,10,14]],
            [[1,8,10],[2,11,13],[3,5,9],[4,12,14],[6,7,15]],
            [[1,6,12],[2,9,14],[3,10,15],[4,8,13],[5,7,11]],
            [[1,11,15],[2,6,8],[3,7,14],[4,9,10],[5,12,13]]
        ]
    },
    '18_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(18)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,17,15],[13,11,18],[16,14,12]],
            [[1,11,12],[4,14,15],[7,17,18],[10,8,6],[13,2,9],[16,5,3]],
            [[10,11,3],[13,14,6],[16,17,9],[1,8,15],[4,2,18],[7,5,12]],
            [[10,2,12],[13,5,15],[16,8,18],[1,17,6],[4,11,9],[7,14,3]],
            [[1,4,7],[2,5,8],[3,6,9],[10,14,18],[11,15,16],[12,13,17]],
            [[1,13,16],[2,14,17],[3,15,18],[10,5,9],[11,6,7],[12,4,8]],
            [[10,13,7],[11,14,8],[12,15,9],[1,5,18],[2,6,16],[3,4,17]],
            [[10,4,16],[11,5,17],[12,6,18],[1,14,9],[2,15,7],[3,13,8]]
        ]
    },
    '21_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(21)) - ověřeno",
        'rounds': [
            [[1,2,6],[5,7,13],[4,11,18],[9,14,16],[3,10,20],[8,15,21],[12,17,19]],
            [[4,5,10],[8,9,11],[2,14,15],[1,17,18],[3,12,21],[6,13,19],[7,16,20]],
            [[1,8,12],[10,11,15],[5,9,17],[3,14,18],[2,7,19],[4,13,20],[6,16,21]],
            [[2,3,4],[6,8,14],[5,12,16],[7,15,17],[1,11,20],[9,13,21],[10,18,19]],
            [[5,6,11],[9,7,12],[3,15,13],[2,18,16],[1,10,21],[4,14,19],[8,17,20]],
            [[2,9,10],[11,12,13],[6,7,18],[1,15,16],[3,8,19],[5,14,20],[4,17,21]],
            [[3,1,5],[4,9,15],[6,10,17],[8,13,18],[2,12,20],[7,14,21],[11,16,19]],
            [[6,4,12],[7,8,10],[1,13,14],[3,16,17],[2,11,21],[5,15,19],[9,18,20]],
            [[3,7,11],[12,10,14],[4,8,16],[2,13,17],[1,9,19],[6,15,20],[5,18,21]],
            [[19,20,21],[1,4,7],[2,5,8],[3,6,9],[10,13,16],[11,14,17],[12,15,18]]
        ]
    },
    '24_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(24)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24]],
            [[10,15,20],[5,19,2],[1,16,9],[4,13,12],[8,3,22],[17,23,14],[6,11,21],[7,18,24]],
            [[4,22,11],[19,6,15],[10,17,9],[5,8,12],[16,20,7],[23,18,3],[2,13,21],[1,14,24]],
            [[5,7,13],[6,2,22],[4,23,9],[19,16,12],[17,11,1],[18,14,20],[15,8,21],[10,3,24]],
            [[19,1,8],[2,15,7],[5,18,9],[6,17,12],[23,13,10],[14,3,11],[22,16,21],[4,20,24]],
            [[6,10,16],[15,22,1],[19,14,9],[2,23,12],[18,8,4],[3,20,13],[7,17,21],[5,11,24]],
            [[2,4,17],[22,7,10],[6,3,9],[15,18,12],[14,16,5],[20,11,8],[1,23,21],[19,13,24]],
            [[15,5,23],[7,1,4],[2,20,9],[22,14,12],[3,17,19],[11,13,16],[10,18,21],[6,8,24]],
            [[22,19,18],[1,10,5],[15,11,9],[7,3,12],[20,23,6],[13,8,17],[4,14,21],[2,16,24]],
            [[7,6,14],[10,4,19],[22,13,9],[1,20,12],[11,18,2],[8,16,23],[5,3,21],[15,17,24]]
        ]
    },
    '27_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(27)) - ověřeno",
        'rounds': [
            [[25,26,27],[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24]],
            [[13,20,18],[4,23,27],[19,12,26],[1,14,21],[22,2,6],[5,15,25],[7,10,16],[9,24,3],[8,11,17]],
            [[10,17,15],[16,9,26],[22,11,18],[19,23,3],[2,12,25],[1,20,27],[4,7,13],[6,21,24],[5,8,14]],
            [[19,2,24],[11,21,25],[10,5,27],[1,18,26],[7,20,3],[4,8,12],[15,6,9],[14,17,23],[13,16,22]],
            [[1,8,6],[10,14,18],[17,3,25],[16,11,27],[7,24,26],[13,2,9],[19,22,4],[21,12,15],[20,23,5]],
            [[7,14,12],[19,8,15],[16,20,24],[23,9,25],[22,17,27],[13,6,26],[3,18,21],[2,5,11],[1,4,10]],
            [[16,23,21],[7,2,27],[22,15,26],[4,17,24],[1,5,9],[8,18,25],[11,14,20],[10,13,19],[12,3,6]],
            [[22,5,3],[14,24,25],[13,8,27],[4,21,26],[10,23,6],[7,11,15],[16,19,1],[18,9,12],[17,20,2]],
            [[4,11,9],[13,17,21],[20,6,25],[19,14,27],[10,3,26],[16,5,12],[23,2,8],[22,1,7],[24,15,18]],
            [[13,5,24],[10,20,9],[4,2,18],[1,17,12],[22,8,21],[16,14,6],[15,3,27],[11,23,26],[19,7,25]],
            [[7,17,6],[1,23,15],[22,14,9],[19,5,18],[13,11,3],[10,2,21],[12,24,27],[8,20,26],[16,4,25]],
            [[22,20,12],[19,11,6],[16,2,15],[10,8,24],[7,23,18],[4,14,3],[5,17,26],[13,1,25],[9,21,27]],
            [[16,8,3],[13,23,12],[7,5,21],[4,20,15],[1,11,24],[19,17,9],[10,22,25],[6,18,27],[2,14,26]]
        ]
    },
    '30_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(30)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[25,26,27],[28,29,30]],
            [[1,4,7],[2,5,10],[3,6,13],[8,11,14],[9,12,15],[16,19,22],[17,20,25],[18,21,28],[23,26,29],[24,27,30]],
            [[1,5,14],[2,4,15],[3,8,12],[6,9,11],[7,10,13],[16,20,29],[17,19,30],[18,23,27],[21,24,26],[22,25,28]],
            [[1,9,13],[2,7,12],[3,4,11],[5,8,15],[6,10,14],[16,24,28],[17,22,27],[18,19,26],[20,23,30],[21,25,29]],
            [[1,8,10],[2,11,13],[3,5,9],[4,12,14],[6,7,15],[16,23,25],[17,26,28],[18,20,24],[19,27,29],[21,22,30]],
            [[1,6,12],[2,9,14],[3,10,15],[4,8,13],[5,7,11],[16,21,27],[17,24,29],[18,25,30],[19,23,28],[20,22,26]],
            [[1,11,15],[2,6,8],[3,7,14],[4,9,10],[5,12,13],[16,26,30],[17,21,23],[18,22,29],[19,24,25],[20,27,28]]
        ]
    },
    '33_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(33)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,17,15],[13,11,18],[16,14,12],[19,20,21],[22,23,24],[25,26,27],[28,29,30],[31,32,33]],
            [[1,11,12],[4,14,15],[7,17,18],[10,8,6],[13,2,9],[16,5,3],[19,23,32],[20,22,33],[21,26,30],[24,27,29],[25,28,31]],
            [[10,11,3],[13,14,6],[16,17,9],[1,8,15],[4,2,18],[7,5,12],[19,22,25],[20,23,28],[21,24,31],[26,29,32],[27,30,33]],
            [[10,2,12],[13,5,15],[16,8,18],[1,17,6],[4,11,9],[7,14,3],[19,27,31],[20,25,30],[21,22,29],[23,26,33],[24,28,32]],
            [[1,4,7],[2,5,8],[3,6,9],[10,14,18],[11,15,16],[12,13,17],[19,26,28],[20,29,31],[21,23,27],[22,30,32],[24,25,33]],
            [[1,13,16],[2,14,17],[3,15,18],[10,5,9],[11,6,7],[12,4,8],[19,24,30],[20,27,32],[21,28,33],[22,26,31],[23,25,29]],
            [[10,13,7],[11,14,8],[12,15,9],[1,5,18],[2,6,16],[3,4,17],[19,29,33],[20,24,26],[21,25,32],[22,27,28],[23,30,31]]
        ]
    },
    '36_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(36)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,17,15],[13,11,18],[16,14,12],[19,20,21],[22,23,24],[25,26,27],[28,35,33],[31,29,36],[34,32,30]],
            [[1,11,12],[4,14,15],[7,17,18],[10,8,6],[13,2,9],[16,5,3],[19,29,30],[22,32,33],[25,35,36],[28,26,24],[31,20,27],[34,23,21]],
            [[10,11,3],[13,14,6],[16,17,9],[1,8,15],[4,2,18],[7,5,12],[28,29,21],[31,32,24],[34,35,27],[19,26,33],[22,20,36],[25,23,30]],
            [[10,2,12],[13,5,15],[16,8,18],[1,17,6],[4,11,9],[7,14,3],[28,20,30],[31,23,33],[34,26,36],[19,35,24],[22,29,27],[25,32,21]],
            [[1,4,7],[2,5,8],[3,6,9],[10,14,18],[11,15,16],[12,13,17],[19,22,25],[20,23,26],[21,24,27],[28,32,36],[29,33,34],[30,31,35]],
            [[1,13,16],[2,14,17],[3,15,18],[10,5,9],[11,6,7],[12,4,8],[19,31,34],[20,32,35],[21,33,36],[28,23,27],[29,24,25],[30,22,26]],
            [[10,13,7],[11,14,8],[12,15,9],[1,5,18],[2,6,16],[3,4,17],[28,31,25],[29,32,26],[30,33,27],[19,23,36],[20,24,34],[21,22,35]],
            [[10,4,16],[11,5,17],[12,6,18],[1,14,9],[2,15,7],[3,13,8],[28,22,34],[29,23,35],[30,24,36],[19,32,27],[20,33,25],[21,31,26]]
        ]
    },
    '39_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(39)) - ověřeno",
        'rounds': [
            [[1,2,6],[5,7,13],[4,11,18],[9,14,16],[3,10,20],[8,15,21],[12,17,19],[22,23,24],[25,26,27],[28,29,30],[31,38,36],[34,32,39],[37,35,33]],
            [[4,5,10],[8,9,11],[2,14,15],[1,17,18],[3,12,21],[6,13,19],[7,16,20],[22,32,33],[25,35,36],[28,38,39],[31,29,27],[34,23,30],[37,26,24]],
            [[1,8,12],[10,11,15],[5,9,17],[3,14,18],[2,7,19],[4,13,20],[6,16,21],[31,32,24],[34,35,27],[37,38,30],[22,29,36],[25,23,39],[28,26,33]],
            [[2,3,4],[6,8,14],[5,12,16],[7,15,17],[1,11,20],[9,13,21],[10,18,19],[31,23,33],[34,26,36],[37,29,39],[22,38,27],[25,32,30],[28,35,24]],
            [[5,6,11],[9,7,12],[3,15,13],[2,18,16],[1,10,21],[4,14,19],[8,17,20],[22,25,28],[23,26,29],[24,27,30],[31,35,39],[32,36,37],[33,34,38]],
            [[2,9,10],[11,12,13],[6,7,18],[1,15,16],[3,8,19],[5,14,20],[4,17,21],[22,34,37],[23,35,38],[24,36,39],[31,26,30],[32,27,28],[33,25,29]],
            [[3,1,5],[4,9,15],[6,10,17],[8,13,18],[2,12,20],[7,14,21],[11,16,19],[31,34,28],[32,35,29],[33,36,30],[22,26,39],[23,27,37],[24,25,38]],
            [[6,4,12],[7,8,10],[1,13,14],[3,16,17],[2,11,21],[5,15,19],[9,18,20],[31,25,37],[32,26,38],[33,27,39],[22,35,30],[23,36,28],[24,34,29]]
        ]
    },
    '42_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(42)) - ověřeno",
        'rounds': [
            [[1,2,6],[5,7,13],[4,11,18],[9,14,16],[3,10,20],[8,15,21],[12,17,19],[22,23,27],[26,28,34],[25,32,39],[30,35,37],[24,31,41],[29,36,42],[33,38,40]],
            [[4,5,10],[8,9,11],[2,14,15],[1,17,18],[3,12,21],[6,13,19],[7,16,20],[25,26,31],[29,30,32],[23,35,36],[22,38,39],[24,33,42],[27,34,40],[28,37,41]],
            [[1,8,12],[10,11,15],[5,9,17],[3,14,18],[2,7,19],[4,13,20],[6,16,21],[22,29,33],[31,32,36],[26,30,38],[24,35,39],[23,28,40],[25,34,41],[27,37,42]],
            [[2,3,4],[6,8,14],[5,12,16],[7,15,17],[1,11,20],[9,13,21],[10,18,19],[23,24,25],[27,29,35],[26,33,37],[28,36,38],[22,32,41],[30,34,42],[31,39,40]],
            [[5,6,11],[9,7,12],[3,15,13],[2,18,16],[1,10,21],[4,14,19],[8,17,20],[26,27,32],[30,28,33],[24,36,34],[23,39,37],[22,31,42],[25,35,40],[29,38,41]],
            [[2,9,10],[11,12,13],[6,7,18],[1,15,16],[3,8,19],[5,14,20],[4,17,21],[23,30,31],[32,33,34],[27,28,39],[22,36,37],[24,29,40],[26,35,41],[25,38,42]],
            [[3,1,5],[4,9,15],[6,10,17],[8,13,18],[2,12,20],[7,14,21],[11,16,19],[24,22,26],[25,30,36],[27,31,38],[29,34,39],[23,33,41],[28,35,42],[32,37,40]],
            [[6,4,12],[7,8,10],[1,13,14],[3,16,17],[2,11,21],[5,15,19],[9,18,20],[27,25,33],[28,29,31],[22,34,35],[24,37,38],[23,32,42],[26,36,40],[30,39,41]],
            [[3,7,11],[12,10,14],[4,8,16],[2,13,17],[1,9,19],[6,15,20],[5,18,21],[24,28,32],[33,31,35],[25,29,37],[23,34,38],[22,30,40],[27,36,41],[26,39,42]],
            [[19,20,21],[1,4,7],[2,5,8],[3,6,9],[10,13,16],[11,14,17],[12,15,18],[40,41,42],[22,25,28],[23,26,29],[24,27,30],[31,34,37],[32,35,38],[33,36,39]]
        ]
    },
    '45_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(45)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[25,26,30],[29,31,37],[28,35,42],[33,38,40],[27,34,44],[32,39,45],[36,41,43]],
            [[10,15,20],[5,19,2],[1,16,9],[4,13,12],[8,3,22],[17,23,14],[6,11,21],[7,18,24],[28,29,34],[32,33,35],[26,38,39],[25,41,42],[27,36,45],[30,37,43],[31,40,44]],
            [[4,22,11],[19,6,15],[10,17,9],[5,8,12],[16,20,7],[23,18,3],[2,13,21],[1,14,24],[25,32,36],[34,35,39],[29,33,41],[27,38,42],[26,31,43],[28,37,44],[30,40,45]],
            [[5,7,13],[6,2,22],[4,23,9],[19,16,12],[17,11,1],[18,14,20],[15,8,21],[10,3,24],[26,27,28],[30,32,38],[29,36,40],[31,39,41],[25,35,44],[33,37,45],[34,42,43]],
            [[19,1,8],[2,15,7],[5,18,9],[6,17,12],[23,13,10],[14,3,11],[22,16,21],[4,20,24],[29,30,35],[33,31,36],[27,39,37],[26,42,40],[25,34,45],[28,38,43],[32,41,44]],
            [[6,10,16],[15,22,1],[19,14,9],[2,23,12],[18,8,4],[3,20,13],[7,17,21],[5,11,24],[26,33,34],[35,36,37],[30,31,42],[25,39,40],[27,32,43],[29,38,44],[28,41,45]],
            [[2,4,17],[22,7,10],[6,3,9],[15,18,12],[14,16,5],[20,11,8],[1,23,21],[19,13,24],[27,25,29],[28,33,39],[30,34,41],[32,37,42],[26,36,44],[31,38,45],[35,40,43]],
            [[15,5,23],[7,1,4],[2,20,9],[22,14,12],[3,17,19],[11,13,16],[10,18,21],[6,8,24],[30,28,36],[31,32,34],[25,37,38],[27,40,41],[26,35,45],[29,39,43],[33,42,44]],
            [[22,19,18],[1,10,5],[15,11,9],[7,3,12],[20,23,6],[13,8,17],[4,14,21],[2,16,24],[27,31,35],[36,34,38],[28,32,40],[26,37,41],[25,33,43],[30,39,44],[29,42,45]],
            [[7,6,14],[10,4,19],[22,13,9],[1,20,12],[11,18,2],[8,16,23],[5,3,21],[15,17,24],[43,44,45],[25,28,31],[26,29,32],[27,30,33],[34,37,40],[35,38,41],[36,39,42]]
        ]
    },
    '48_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(48)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[25,26,27],[28,29,30],[31,32,33],[34,35,36],[37,38,39],[40,41,42],[43,44,45],[46,47,48]],
            [[10,15,20],[5,19,2],[1,16,9],[4,13,12],[8,3,22],[17,23,14],[6,11,21],[7,18,24],[34,39,44],[29,43,26],[25,40,33],[28,37,36],[32,27,46],[41,47,38],[30,35,45],[31,42,48]],
            [[4,22,11],[19,6,15],[10,17,9],[5,8,12],[16,20,7],[23,18,3],[2,13,21],[1,14,24],[28,46,35],[43,30,39],[34,41,33],[29,32,36],[40,44,31],[47,42,27],[26,37,45],[25,38,48]],
            [[5,7,13],[6,2,22],[4,23,9],[19,16,12],[17,11,1],[18,14,20],[15,8,21],[10,3,24],[29,31,37],[30,26,46],[28,47,33],[43,40,36],[41,35,25],[42,38,44],[39,32,45],[34,27,48]],
            [[19,1,8],[2,15,7],[5,18,9],[6,17,12],[23,13,10],[14,3,11],[22,16,21],[4,20,24],[43,25,32],[26,39,31],[29,42,33],[30,41,36],[47,37,34],[38,27,35],[46,40,45],[28,44,48]],
            [[6,10,16],[15,22,1],[19,14,9],[2,23,12],[18,8,4],[3,20,13],[7,17,21],[5,11,24],[30,34,40],[39,46,25],[43,38,33],[26,47,36],[42,32,28],[27,44,37],[31,41,45],[29,35,48]],
            [[2,4,17],[22,7,10],[6,3,9],[15,18,12],[14,16,5],[20,11,8],[1,23,21],[19,13,24],[26,28,41],[46,31,34],[30,27,33],[39,42,36],[38,40,29],[44,35,32],[25,47,45],[43,37,48]],
            [[15,5,23],[7,1,4],[2,20,9],[22,14,12],[3,17,19],[11,13,16],[10,18,21],[6,8,24],[39,29,47],[31,25,28],[26,44,33],[46,38,36],[27,41,43],[35,37,40],[34,42,45],[30,32,48]],
            [[22,19,18],[1,10,5],[15,11,9],[7,3,12],[20,23,6],[13,8,17],[4,14,21],[2,16,24],[46,43,42],[25,34,29],[39,35,33],[31,27,36],[44,47,30],[37,32,41],[28,38,45],[26,40,48]],
            [[7,6,14],[10,4,19],[22,13,9],[1,20,12],[11,18,2],[8,16,23],[5,3,21],[15,17,24],[31,30,38],[34,28,43],[46,37,33],[25,44,36],[35,42,26],[32,40,47],[29,27,45],[39,41,48]]
        ]
    },
    '51_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(51)) - ověřeno",
        'rounds': [
            [[25,26,27],[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[28,29,30],[31,32,33],[34,35,36],[37,38,39],[40,41,42],[43,44,45],[46,47,48],[49,50,51]],
            [[13,20,18],[4,23,27],[19,12,26],[1,14,21],[22,2,6],[5,15,25],[7,10,16],[9,24,3],[8,11,17],[37,42,47],[32,46,29],[28,43,36],[31,40,39],[35,30,49],[44,50,41],[33,38,48],[34,45,51]],
            [[10,17,15],[16,9,26],[22,11,18],[19,23,3],[2,12,25],[1,20,27],[4,7,13],[6,21,24],[5,8,14],[31,49,38],[46,33,42],[37,44,36],[32,35,39],[43,47,34],[50,45,30],[29,40,48],[28,41,51]],
            [[19,2,24],[11,21,25],[10,5,27],[1,18,26],[7,20,3],[4,8,12],[15,6,9],[14,17,23],[13,16,22],[32,34,40],[33,29,49],[31,50,36],[46,43,39],[44,38,28],[45,41,47],[42,35,48],[37,30,51]],
            [[1,8,6],[10,14,18],[17,3,25],[16,11,27],[7,24,26],[13,2,9],[19,22,4],[21,12,15],[20,23,5],[46,28,35],[29,42,34],[32,45,36],[33,44,39],[50,40,37],[41,30,38],[49,43,48],[31,47,51]],
            [[7,14,12],[19,8,15],[16,20,24],[23,9,25],[22,17,27],[13,6,26],[3,18,21],[2,5,11],[1,4,10],[33,37,43],[42,49,28],[46,41,36],[29,50,39],[45,35,31],[30,47,40],[34,44,48],[32,38,51]],
            [[16,23,21],[7,2,27],[22,15,26],[4,17,24],[1,5,9],[8,18,25],[11,14,20],[10,13,19],[12,3,6],[29,31,44],[49,34,37],[33,30,36],[42,45,39],[41,43,32],[47,38,35],[28,50,48],[46,40,51]],
            [[22,5,3],[14,24,25],[13,8,27],[4,21,26],[10,23,6],[7,11,15],[16,19,1],[18,9,12],[17,20,2],[42,32,50],[34,28,31],[29,47,36],[49,41,39],[30,44,46],[38,40,43],[37,45,48],[33,35,51]],
            [[4,11,9],[13,17,21],[20,6,25],[19,14,27],[10,3,26],[16,5,12],[23,2,8],[22,1,7],[24,15,18],[49,46,45],[28,37,32],[42,38,36],[34,30,39],[47,50,33],[40,35,44],[31,41,48],[29,43,51]],
            [[13,5,24],[10,20,9],[4,2,18],[1,17,12],[22,8,21],[16,14,6],[15,3,27],[11,23,26],[19,7,25],[34,33,41],[37,31,46],[49,40,36],[28,47,39],[38,45,29],[35,43,50],[32,30,48],[42,44,51]]
        ]
    },
    '54_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(54)) - ověřeno",
        'rounds': [
            [[25,26,27],[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[52,53,54],[28,29,30],[31,32,33],[34,35,36],[37,38,39],[40,41,42],[43,44,45],[46,47,48],[49,50,51]],
            [[13,20,18],[4,23,27],[19,12,26],[1,14,21],[22,2,6],[5,15,25],[7,10,16],[9,24,3],[8,11,17],[40,47,45],[31,50,54],[46,39,53],[28,41,48],[49,29,33],[32,42,52],[34,37,43],[36,51,30],[35,38,44]],
            [[10,17,15],[16,9,26],[22,11,18],[19,23,3],[2,12,25],[1,20,27],[4,7,13],[6,21,24],[5,8,14],[37,44,42],[43,36,53],[49,38,45],[46,50,30],[29,39,52],[28,47,54],[31,34,40],[33,48,51],[32,35,41]],
            [[19,2,24],[11,21,25],[10,5,27],[1,18,26],[7,20,3],[4,8,12],[15,6,9],[14,17,23],[13,16,22],[46,29,51],[38,48,52],[37,32,54],[28,45,53],[34,47,30],[31,35,39],[42,33,36],[41,44,50],[40,43,49]],
            [[1,8,6],[10,14,18],[17,3,25],[16,11,27],[7,24,26],[13,2,9],[19,22,4],[21,12,15],[20,23,5],[28,35,33],[37,41,45],[44,30,52],[43,38,54],[34,51,53],[40,29,36],[46,49,31],[48,39,42],[47,50,32]],
            [[7,14,12],[19,8,15],[16,20,24],[23,9,25],[22,17,27],[13,6,26],[3,18,21],[2,5,11],[1,4,10],[34,41,39],[46,35,42],[43,47,51],[50,36,52],[49,44,54],[40,33,53],[30,45,48],[29,32,38],[28,31,37]],
            [[16,23,21],[7,2,27],[22,15,26],[4,17,24],[1,5,9],[8,18,25],[11,14,20],[10,13,19],[12,3,6],[43,50,48],[34,29,54],[49,42,53],[31,44,51],[28,32,36],[35,45,52],[38,41,47],[37,40,46],[39,30,33]],
            [[22,5,3],[14,24,25],[13,8,27],[4,21,26],[10,23,6],[7,11,15],[16,19,1],[18,9,12],[17,20,2],[49,32,30],[41,51,52],[40,35,54],[31,48,53],[37,50,33],[34,38,42],[43,46,28],[45,36,39],[44,47,29]],
            [[4,11,9],[13,17,21],[20,6,25],[19,14,27],[10,3,26],[16,5,12],[23,2,8],[22,1,7],[24,15,18],[31,38,36],[40,44,48],[47,33,52],[46,41,54],[37,30,53],[43,32,39],[50,29,35],[49,28,34],[51,42,45]],
            [[13,5,24],[10,20,9],[4,2,18],[1,17,12],[22,8,21],[16,14,6],[15,3,27],[11,23,26],[19,7,25],[40,32,51],[37,47,36],[31,29,45],[28,44,39],[49,35,48],[43,41,33],[42,30,54],[38,50,53],[46,34,52]],
            [[7,17,6],[1,23,15],[22,14,9],[19,5,18],[13,11,3],[10,2,21],[12,24,27],[8,20,26],[16,4,25],[34,44,33],[28,50,42],[49,41,36],[46,32,45],[40,38,30],[37,29,48],[39,51,54],[35,47,53],[43,31,52]],
            [[22,20,12],[19,11,6],[16,2,15],[10,8,24],[7,23,18],[4,14,3],[5,17,26],[13,1,25],[9,21,27],[49,47,39],[46,38,33],[43,29,42],[37,35,51],[34,50,45],[31,41,30],[32,44,53],[40,28,52],[36,48,54]],
            [[16,8,3],[13,23,12],[7,5,21],[4,20,15],[1,11,24],[19,17,9],[10,22,25],[6,18,27],[2,14,26],[43,35,30],[40,50,39],[34,32,48],[31,47,42],[28,38,51],[46,44,36],[37,49,52],[33,45,54],[29,41,53]]
        ]
    },
    '57_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(57)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[25,26,27],[28,29,30],[55,56,57],[31,32,33],[34,35,36],[37,38,39],[40,41,42],[43,44,45],[46,47,48],[49,50,51],[52,53,54]],
            [[1,4,7],[2,5,10],[3,6,13],[8,11,14],[9,12,15],[16,19,22],[17,20,25],[18,21,28],[23,26,29],[24,27,30],[43,50,48],[34,53,57],[49,42,56],[31,44,51],[52,32,36],[35,45,55],[37,40,46],[39,54,33],[38,41,47]],
            [[1,5,14],[2,4,15],[3,8,12],[6,9,11],[7,10,13],[16,20,29],[17,19,30],[18,23,27],[21,24,26],[22,25,28],[40,47,45],[46,39,56],[52,41,48],[49,53,33],[32,42,55],[31,50,57],[34,37,43],[36,51,54],[35,38,44]],
            [[1,9,13],[2,7,12],[3,4,11],[5,8,15],[6,10,14],[16,24,28],[17,22,27],[18,19,26],[20,23,30],[21,25,29],[49,32,54],[41,51,55],[40,35,57],[31,48,56],[37,50,33],[34,38,42],[45,36,39],[44,47,53],[43,46,52]],
            [[1,8,10],[2,11,13],[3,5,9],[4,12,14],[6,7,15],[16,23,25],[17,26,28],[18,20,24],[19,27,29],[21,22,30],[31,38,36],[40,44,48],[47,33,55],[46,41,57],[37,54,56],[43,32,39],[49,52,34],[51,42,45],[50,53,35]],
            [[1,6,12],[2,9,14],[3,10,15],[4,8,13],[5,7,11],[16,21,27],[17,24,29],[18,25,30],[19,23,28],[20,22,26],[37,44,42],[49,38,45],[46,50,54],[53,39,55],[52,47,57],[43,36,56],[33,48,51],[32,35,41],[31,34,40]],
            [[1,11,15],[2,6,8],[3,7,14],[4,9,10],[5,12,13],[16,26,30],[17,21,23],[18,22,29],[19,24,25],[20,27,28],[46,53,51],[37,32,57],[52,45,56],[34,47,54],[31,35,39],[38,48,55],[41,44,50],[40,43,49],[42,33,36]]
        ]
    },
    '60_3': {
        'group_size': 3,
        'description': "Kirkman Triple System (KTS(60)) - ověřeno",
        'rounds': [
            [[1,2,3],[4,5,6],[7,8,9],[10,11,12],[13,14,15],[16,17,18],[19,20,21],[22,23,24],[25,26,27],[28,29,30],[31,32,33],[34,35,36],[37,38,39],[40,41,42],[43,44,45],[46,47,48],[49,50,51],[52,53,54],[55,56,57],[58,59,60]],
            [[1,4,7],[2,5,10],[3,6,13],[8,11,14],[9,12,15],[16,19,22],[17,20,25],[18,21,28],[23,26,29],[24,27,30],[31,34,37],[32,35,40],[33,36,43],[38,41,44],[39,42,45],[46,49,52],[47,50,55],[48,51,58],[53,56,59],[54,57,60]],
            [[1,5,14],[2,4,15],[3,8,12],[6,9,11],[7,10,13],[16,20,29],[17,19,30],[18,23,27],[21,24,26],[22,25,28],[31,35,44],[32,34,45],[33,38,42],[36,39,41],[37,40,43],[46,50,59],[47,49,60],[48,53,57],[51,54,56],[52,55,58]],
            [[1,9,13],[2,7,12],[3,4,11],[5,8,15],[6,10,14],[16,24,28],[17,22,27],[18,19,26],[20,23,30],[21,25,29],[31,39,43],[32,37,42],[33,34,41],[35,38,45],[36,40,44],[46,54,58],[47,52,57],[48,49,56],[50,53,60],[51,55,59]],
            [[1,8,10],[2,11,13],[3,5,9],[4,12,14],[6,7,15],[16,23,25],[17,26,28],[18,20,24],[19,27,29],[21,22,30],[31,38,40],[32,41,43],[33,35,39],[34,42,44],[36,37,45],[46,53,55],[47,56,58],[48,50,54],[49,57,59],[51,52,60]],
            [[1,6,12],[2,9,14],[3,10,15],[4,8,13],[5,7,11],[16,21,27],[17,24,29],[18,25,30],[19,23,28],[20,22,26],[31,36,42],[32,39,44],[33,40,45],[34,38,43],[35,37,41],[46,51,57],[47,54,59],[48,55,60],[49,53,58],[50,52,56]],
            [[1,11,15],[2,6,8],[3,7,14],[4,9,10],[5,12,13],[16,26,30],[17,21,23],[18,22,29],[19,24,25],[20,27,28],[31,41,45],[32,36,38],[33,37,44],[34,39,40],[35,42,43],[46,56,60],[47,51,53],[48,52,59],[49,54,55],[50,57,58]]
        ]
    },
    
    # 4členné skupiny
    '16_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(16)) - ověřeno",
        'rounds': [
            [[1,2,3,4], [5,6,7,8], [9,10,11,12], [13,14,15,16]],
            [[1,5,9,13], [2,6,10,14], [3,7,11,15], [4,8,12,16]],
            [[1,6,11,16], [2,5,12,15], [3,8,9,14], [4,7,10,13]],
            [[1,7,12,14], [2,8,11,13], [3,5,10,16], [4,6,9,15]],
            [[1,8,10,15], [2,7,9,16], [3,6,12,13], [4,5,11,14]]
        ]
    },
    '20_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(20)) - ověřeno",
        'rounds': [
            [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12], [13, 14, 15, 16], [17, 18, 19, 20]],
            [[1, 5, 9, 13], [2, 6, 10, 17], [3, 7, 14, 18], [4, 11, 15, 19], [8, 12, 16, 20]],
            [[1, 6, 15, 20], [2, 5, 12, 18], [3, 9, 16, 19], [4, 7, 10, 13], [8, 11, 14, 17]],
            [[1, 10, 16, 18], [2, 8, 13, 19], [3, 5, 11, 20], [4, 6, 9, 14], [7, 12, 15, 17]],
            [[1, 12, 14, 19], [2, 7, 9, 20], [3, 8, 10, 15], [4, 5, 16, 17], [6, 11, 13, 18]]
        ]
    },
    '24_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(24)) - ověřeno",
        'rounds': [
            [[1,2,11,21],[9,10,19,5],[17,18,3,13],[4,7,6,24],[8,12,14,15],[16,20,22,23]],
            [[1,3,12,22],[9,11,20,6],[17,19,4,14],[5,8,7,18],[2,13,15,16],[10,21,23,24]],
            [[1,4,13,23],[9,12,21,7],[17,20,5,15],[6,2,8,19],[3,10,14,16],[11,18,22,24]],
            [[1,5,14,24],[9,13,22,8],[17,21,6,16],[7,3,2,20],[4,10,11,15],[12,18,19,23]],
            [[1,6,15,18],[9,14,23,2],[17,22,7,10],[8,4,3,21],[5,11,12,16],[13,19,20,24]],
            [[1,7,16,19],[9,15,24,3],[17,23,8,11],[2,5,4,22],[6,10,12,13],[14,18,20,21]],
            [[1,8,10,20],[9,16,18,4],[17,24,2,12],[3,6,5,23],[7,11,13,14],[15,19,21,22]]
        ]
    },
    '28_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(28)) - ověřeno",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16],[17,18,19,20],[21,22,23,24],[25,26,27,28]],
            [[1,5,21,25],[2,6,13,17],[14,18,22,26],[7,9,19,27],[8,10,15,23],[3,11,16,28],[4,12,20,24]],
            [[1,6,24,28],[2,5,15,19],[16,20,23,27],[8,11,17,26],[7,12,13,22],[3,9,14,25],[4,10,18,21]],
            [[1,9,17,23],[2,10,14,28],[5,11,13,24],[6,12,18,27],[16,19,21,26],[3,7,15,20],[4,8,22,25]],
            [[1,7,16,18],[2,8,21,27],[5,12,14,23],[15,17,22,28],[6,11,20,25],[3,10,19,24],[4,9,13,26]],
            [[1,11,19,22],[2,12,16,25],[6,9,15,21],[5,10,20,26],[14,17,24,27],[3,8,13,18],[4,7,23,28]],
            [[1,8,14,20],[2,7,24,26],[6,10,16,22],[13,19,23,25],[5,9,18,28],[3,12,17,21],[4,11,15,27]],
            [[1,12,15,26],[2,11,18,23],[7,10,17,25],[13,20,21,28],[8,9,16,24],[3,5,22,27],[4,6,14,19]],
            [[1,10,13,27],[2,9,20,22],[3,6,23,26],[4,5,16,17],[7,11,14,21],[8,12,19,28],[15,18,24,25]]
        ]
    },
    '32_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(32)) - ověřeno",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,16,15],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32]],
            [[1,5,9,29],[2,23,19,8],[4,6,11,32],[27,16,20,22],[13,17,21,25],[3,24,18,7],[26,14,31,12],[28,10,30,15]],
            [[1,28,31,22],[2,24,27,29],[4,14,7,25],[6,17,12,15],[13,18,8,11],[3,16,21,10],[5,26,19,32],[23,9,20,30]],
            [[1,19,25,12],[2,26,20,11],[4,27,18,10],[6,23,31,16],[22,7,15,32],[3,9,28,17],[5,24,13,30],[14,21,8,29]],
            [[1,23,14,11],[2,5,28,16],[4,9,31,8],[24,20,25,15],[18,21,12,32],[3,26,22,29],[6,13,19,10],[27,17,7,30]],
            [[1,24,10,32],[2,6,25,30],[4,19,29,15],[9,14,18,22],[28,21,7,11],[3,13,31,20],[5,23,27,12],[26,16,17,8]],
            [[1,6,20,21],[2,31,7,10],[4,5,17,22],[24,28,14,19],[16,25,11,29],[3,8,12,30],[23,26,18,15],[9,27,13,32]],
            [[1,16,18,30],[2,14,17,32],[4,23,28,13],[27,31,19,21],[22,8,25,10],[3,5,11,15],[6,24,9,26],[20,7,12,29]],
            [[1,26,13,7],[2,9,21,15],[4,24,16,12],[23,17,10,29],[19,22,11,30],[3,6,27,14],[5,31,18,25],[28,20,8,32]],
            [[1,27,8,15],[2,13,22,12],[4,26,21,30],[6,28,18,29],[9,16,19,7],[3,23,25,32],[5,14,20,10],[24,31,17,11]]
        ]
    },
    '36_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(36)) - zatím pouze 5 kol z 11 možných",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32],[33,34,35,36]],
            [[1,5,9,13],[2,6,10,17],[3,7,14,18],[4,11,15,19],[8,12,16,20],[21,25,29,33],[22,26,30,34],[23,27,31,35],[24,28,32,36]],
            [[1,6,15,20],[2,5,12,18],[3,9,16,19],[4,7,10,13],[8,11,14,17],[21,26,31,36],[22,25,32,35],[23,28,29,34],[24,27,30,33]],
            [[1,10,16,18],[2,8,13,19],[3,5,11,20],[4,6,9,14],[7,12,15,17],[21,27,32,34],[22,28,31,33],[23,25,30,36],[24,26,29,35]],
            [[1,12,14,19],[2,7,9,20],[3,8,10,15],[4,5,16,17],[6,11,13,18],[21,28,30,35],[22,27,29,36],[23,26,32,33],[24,25,31,34]]
        ]
    },
    '40_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(40)) - zatím pouze 5 kol z X možných",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40]],
            [[1,5,9,13],[2,6,10,17],[3,7,14,18],[4,11,15,19],[8,12,16,20],[21,25,29,33],[22,26,30,37],[23,27,34,38],[24,31,35,39],[28,32,36,40]],
            [[1,6,15,20],[2,5,12,18],[3,9,16,19],[4,7,10,13],[8,11,14,17],[21,26,35,40],[22,25,32,38],[23,29,36,39],[24,27,30,33],[28,31,34,37]],
            [[1,10,16,18],[2,8,13,19],[3,5,11,20],[4,6,9,14],[7,12,15,17],[21,30,36,38],[22,28,33,39],[23,25,31,40],[24,26,29,34],[27,32,35,37]],
            [[1,12,14,19],[2,7,9,20],[3,8,10,15],[4,5,16,17],[6,11,13,18],[21,32,34,39],[22,27,29,40],[23,28,30,35],[24,25,36,37],[26,31,33,38]]
        ]
    },
    '44_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(44)) - zatím pouze 5 kol z X možných",
        'rounds': [
            [[1,2,11,21],[9,10,19,5],[17,18,3,13],[4,7,6,24],[8,12,14,15],[16,20,22,23],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40],[41,42,43,44]],
            [[1,3,12,22],[9,11,20,6],[17,19,4,14],[5,8,7,18],[2,13,15,16],[10,21,23,24],[25,29,33,37],[26,30,34,41],[27,31,38,42],[28,35,39,43],[32,36,40,44]],
            [[1,4,13,23],[9,12,21,7],[17,20,5,15],[6,2,8,19],[3,10,14,16],[11,18,22,24],[25,30,39,44],[26,29,36,42],[27,33,40,43],[28,31,34,37],[32,35,38,41]],
            [[1,5,14,24],[9,13,22,8],[17,21,6,16],[7,3,2,20],[4,10,11,15],[12,18,19,23],[25,34,40,42],[26,32,37,43],[27,29,35,44],[28,30,33,38],[31,36,39,41]],
            [[1,7,16,19],[9,15,24,3],[17,23,8,11],[2,5,4,22],[6,10,12,13],[14,18,20,21],[25,36,38,43],[26,31,33,44],[27,32,34,39],[28,29,40,41],[30,35,37,42]]
        ]
    },
    '48_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(48)) - zatím pouze 7 kol z X možných",
        'rounds': [
            [[1,2,11,21],[9,10,19,5],[17,18,3,13],[4,7,6,24],[8,12,14,15],[16,20,22,23],[25,26,35,45],[33,34,43,29],[41,42,27,37],[28,31,30,48],[32,36,38,39],[40,44,46,47]],
            [[1,3,12,22],[9,11,20,6],[17,19,4,14],[5,8,7,18],[2,13,15,16],[10,21,23,24],[25,27,36,46],[33,35,44,30],[41,43,28,38],[29,32,31,42],[26,37,39,40],[34,45,47,48]],
            [[1,4,13,23],[9,12,21,7],[17,20,5,15],[6,2,8,19],[3,10,14,16],[11,18,22,24],[25,28,37,47],[33,36,45,31],[41,44,29,39],[30,26,32,43],[27,34,38,40],[35,42,46,48]],
            [[1,5,14,24],[9,13,22,8],[17,21,6,16],[7,3,2,20],[4,10,11,15],[12,18,19,23],[25,29,38,48],[33,37,46,32],[41,45,30,40],[31,27,26,44],[28,34,35,39],[36,42,43,47]],
            [[1,6,15,18],[9,14,23,2],[17,22,7,10],[8,4,3,21],[5,11,12,16],[13,19,20,24],[25,30,39,42],[33,38,47,26],[41,46,31,34],[32,28,27,45],[29,35,36,40],[37,43,44,48]],
            [[1,7,16,19],[9,15,24,3],[17,23,8,11],[2,5,4,22],[6,10,12,13],[14,18,20,21],[25,31,40,43],[33,39,48,27],[41,47,32,35],[26,29,28,46],[30,34,36,37],[38,42,44,45]],
            [[1,8,10,20],[9,16,18,4],[17,24,2,12],[3,6,5,23],[7,11,13,14],[15,19,21,22],[25,32,34,44],[33,40,42,28],[41,48,26,36],[27,30,29,47],[31,35,37,38],[39,43,45,46]]
        ]
    },
    '52_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(52)) - zatím pouze 7 kol z X možných",
        'rounds': [
            [[1,2,11,21],[9,10,19,5],[17,18,3,13],[4,7,6,24],[8,12,14,15],[16,20,22,23],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40],[41,42,43,44],[45,46,47,48],[49,50,51,52]],
            [[1,3,12,22],[9,11,20,6],[17,19,4,14],[5,8,7,18],[2,13,15,16],[10,21,23,24],[25,29,45,49],[26,30,37,41],[38,42,46,50],[31,33,43,51],[32,34,39,47],[27,35,40,52],[28,36,44,48]],
            [[1,4,13,23],[9,12,21,7],[17,20,5,15],[6,2,8,19],[3,10,14,16],[11,18,22,24],[25,30,48,52],[26,29,39,43],[40,44,47,51],[32,35,41,50],[31,36,37,46],[27,33,38,49],[28,34,42,45]],
            [[1,5,14,24],[9,13,22,8],[17,21,6,16],[7,3,2,20],[4,10,11,15],[12,18,19,23],[25,33,41,47],[26,34,38,52],[29,35,37,48],[30,36,42,51],[40,43,45,50],[27,31,39,44],[28,32,46,49]],
            [[1,6,15,18],[9,14,23,2],[17,22,7,10],[8,4,3,21],[5,11,12,16],[13,19,20,24],[25,31,40,42],[26,32,45,51],[29,36,38,47],[39,41,46,52],[30,35,44,49],[27,34,43,48],[28,33,37,50]],
            [[1,7,16,19],[9,15,24,3],[17,23,8,11],[2,5,4,22],[6,10,12,13],[14,18,20,21],[25,35,43,46],[26,36,40,49],[30,33,39,45],[29,34,44,50],[38,41,48,51],[27,32,37,42],[28,31,47,52]],
            [[1,8,10,20],[9,16,18,4],[17,24,2,12],[3,6,5,23],[7,11,13,14],[15,19,21,22],[25,32,38,44],[26,31,48,50],[30,34,40,46],[37,43,47,49],[29,33,42,52],[27,36,41,45],[28,35,39,51]]
        ]
        },
    '56_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(56)) - zatím pouze 9 kol z X možných",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,15,16],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40],[41,42,43,44],[45,46,47,48],[49,50,51,52],[53,54,55,56]],
            [[1,5,21,25],[2,6,13,17],[14,18,22,26],[7,9,19,27],[8,10,15,23],[3,11,16,28],[4,12,20,24],[29,33,49,53],[30,34,41,45],[42,46,50,54],[35,37,47,55],[36,38,43,51],[31,39,44,56],[32,40,48,52]],
            [[1,6,24,28],[2,5,15,19],[16,20,23,27],[8,11,17,26],[7,12,13,22],[3,9,14,25],[4,10,18,21],[29,34,52,56],[30,33,43,47],[44,48,51,55],[36,39,45,54],[35,40,41,50],[31,37,42,53],[32,38,46,49]],
            [[1,9,17,23],[2,10,14,28],[5,11,13,24],[6,12,18,27],[16,19,21,26],[3,7,15,20],[4,8,22,25],[29,37,45,51],[30,38,42,56],[33,39,41,52],[34,40,46,55],[44,47,49,54],[31,35,43,48],[32,36,50,53]],
            [[1,7,16,18],[2,8,21,27],[5,12,14,23],[15,17,22,28],[6,11,20,25],[3,10,19,24],[4,9,13,26],[29,35,44,46],[30,36,49,55],[33,40,42,51],[43,45,50,56],[34,39,48,53],[31,38,47,52],[32,37,41,54]],
            [[1,11,19,22],[2,12,16,25],[6,9,15,21],[5,10,20,26],[14,17,24,27],[3,8,13,18],[4,7,23,28],[29,39,47,50],[30,40,44,53],[34,37,43,49],[33,38,48,54],[42,45,52,55],[31,36,41,46],[32,35,51,56]],
            [[1,8,14,20],[2,7,24,26],[6,10,16,22],[13,19,23,25],[5,9,18,28],[3,12,17,21],[4,11,15,27],[29,36,42,48],[30,35,52,54],[34,38,44,50],[41,47,51,53],[33,37,46,56],[31,40,45,49],[32,39,43,55]],
            [[1,12,15,26],[2,11,18,23],[7,10,17,25],[13,20,21,28],[8,9,16,24],[3,5,22,27],[4,6,14,19],[29,40,43,54],[30,39,46,51],[35,38,45,53],[41,48,49,56],[36,37,44,52],[31,33,50,55],[32,34,42,47]],
            [[1,10,13,27],[2,9,20,22],[3,6,23,26],[4,5,16,17],[7,11,14,21],[8,12,19,28],[15,18,24,25],[29,38,41,55],[30,37,48,50],[31,34,51,54],[32,33,44,45],[35,39,42,49],[36,40,47,56],[43,46,52,53]]
        ]
    },
    '60_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(60)) - ověřeno",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,16,15],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40],[41,42,43,44],[45,46,47,48],[49,50,51,52],[53,54,55,56],[57,58,59,60]],
            [[1,5,9,29],[2,23,19,8],[4,6,11,32],[27,16,20,22],[13,17,21,25],[3,24,18,7],[26,14,31,12],[28,10,30,15],[33,37,53,57],[34,38,45,49],[46,50,54,58],[39,41,51,59],[40,42,47,55],[35,43,48,60],[36,44,52,56]],
            [[1,28,31,22],[2,24,27,29],[4,14,7,25],[6,17,12,15],[13,18,8,11],[3,16,21,10],[5,26,19,32],[23,9,20,30],[33,38,56,60],[34,37,47,51],[48,52,55,59],[40,43,49,58],[39,44,45,54],[35,41,46,57],[36,42,50,53]],
            [[1,19,25,12],[2,26,20,11],[4,27,18,10],[6,23,31,16],[22,7,15,32],[3,9,28,17],[5,24,13,30],[14,21,8,29],[33,41,49,55],[34,42,46,60],[37,43,45,56],[38,44,50,59],[48,51,53,58],[35,39,47,52],[36,40,54,57]],
            [[1,23,14,11],[2,5,28,16],[4,9,31,8],[24,20,25,15],[18,21,12,32],[3,26,22,29],[6,13,19,10],[27,17,7,30],[33,39,48,50],[34,40,53,59],[37,44,46,55],[47,49,54,60],[38,43,52,57],[35,42,51,56],[36,41,45,58]],
            [[1,24,10,32],[2,6,25,30],[4,19,29,15],[9,14,18,22],[28,21,7,11],[3,13,31,20],[5,23,27,12],[26,16,17,8],[33,43,51,54],[34,44,48,57],[38,41,47,53],[37,42,52,58],[46,49,56,59],[35,40,45,50],[36,39,55,60]],
            [[1,6,20,21],[2,31,7,10],[4,5,17,22],[24,28,14,19],[16,25,11,29],[3,8,12,30],[23,26,18,15],[9,27,13,32],[33,40,46,52],[34,39,56,58],[38,42,48,54],[45,51,55,57],[37,41,50,60],[35,44,49,53],[36,43,47,59]],
            [[1,16,18,30],[2,14,17,32],[4,23,28,13],[27,31,19,21],[22,8,25,10],[3,5,11,15],[6,24,9,26],[20,7,12,29],[33,44,47,58],[34,43,50,55],[39,42,49,57],[45,52,53,60],[40,41,48,56],[35,37,54,59],[36,38,46,51]],
            [[1,26,13,7],[2,9,21,15],[4,24,16,12],[23,17,10,29],[19,22,11,30],[3,6,27,14],[5,31,18,25],[28,20,8,32],[33,42,45,59],[34,41,52,54],[35,38,55,58],[36,37,48,49],[39,43,46,53],[40,44,51,60],[47,50,56,57]]
        ]
    },
    '128_4': {
        'group_size': 4,
        'description': "Řešitelný Steinerův čtyřnásobný systém (RSQS(128)) - ověřeno",
        'rounds': [
            [[1,2,3,4],[5,6,7,8],[9,10,11,12],[13,14,16,15],[17,18,19,20],[21,22,23,24],[25,26,27,28],[29,30,31,32],[33,34,35,36],[37,38,39,40],[41,42,43,44],[45,46,48,47],[49,50,51,52],[53,54,55,56],[57,58,59,60],[61,62,63,64],[65,66,67,68],[69,70,71,72],[73,74,75,76],[77,78,80,79],[81,82,83,84],[85,86,87,88],[89,90,91,92],[93,94,95,96],[97,98,99,100],[101,102,103,104],[105,106,107,108],[109,110,112,111],[113,114,115,116],[117,118,119,120],[121,122,123,124],[125,126,127,128]],
            [[1,5,9,29],[2,23,19,8],[4,6,11,32],[27,16,20,22],[13,17,21,25],[3,24,18,7],[26,14,31,12],[28,10,30,15],[33,37,41,61],[34,55,51,40],[36,38,43,64],[59,48,52,54],[45,49,53,57],[35,56,50,39],[58,46,63,44],[60,42,62,47],[65,69,73,93],[66,87,83,72],[68,70,75,96],[91,80,84,86],[77,81,85,89],[67,88,82,71],[90,78,95,76],[92,74,94,79],[97,101,105,125],[98,119,115,104],[100,102,107,128],[123,112,116,118],[109,113,117,121],[99,120,114,103],[122,110,127,108],[124,106,126,111]],
            [[1,28,31,22],[2,24,27,29],[4,14,7,25],[6,17,12,15],[13,18,8,11],[3,16,21,10],[5,26,19,32],[23,9,20,30],[33,60,63,54],[34,56,59,61],[36,46,39,57],[38,49,44,47],[45,50,40,43],[35,48,53,42],[37,58,51,64],[55,41,52,62],[65,92,95,86],[66,88,91,93],[68,78,71,89],[70,81,76,79],[77,82,72,75],[67,80,85,74],[69,90,83,96],[87,73,84,94],[97,124,127,118],[98,120,123,125],[100,110,103,121],[102,113,108,111],[109,114,104,107],[99,112,117,106],[101,122,115,128],[119,105,116,126]],
            [[1,19,25,12],[2,26,20,11],[4,27,18,10],[6,23,31,16],[22,7,15,32],[3,9,28,17],[5,24,13,30],[14,21,8,29],[33,51,57,44],[34,58,52,43],[36,59,50,42],[38,55,63,48],[54,39,47,64],[35,41,60,49],[37,56,45,62],[46,53,40,61],[65,83,89,76],[66,90,84,75],[68,91,82,74],[70,87,95,80],[86,71,79,96],[67,73,92,81],[69,88,77,94],[78,85,72,93],[97,115,121,108],[98,122,116,107],[100,123,114,106],[102,119,127,112],[118,103,111,128],[99,105,124,113],[101,120,109,126],[110,117,104,125]],
            [[1,23,14,11],[2,5,28,16],[4,9,31,8],[24,20,25,15],[18,21,12,32],[3,26,22,29],[6,13,19,10],[27,17,7,30],[33,55,46,43],[34,37,60,48],[36,41,63,40],[56,52,57,47],[50,53,44,64],[35,58,54,61],[38,45,51,42],[59,49,39,62],[65,87,78,75],[66,69,92,80],[68,73,95,72],[88,84,89,79],[82,85,76,96],[67,90,86,93],[70,77,83,74],[91,81,71,94],[97,119,110,107],[98,101,124,112],[100,105,127,104],[120,116,121,111],[114,117,108,128],[99,122,118,125],[102,109,115,106],[123,113,103,126]],
            [[1,24,10,32],[2,6,25,30],[4,19,29,15],[9,14,18,22],[28,21,7,11],[3,13,31,20],[5,23,27,12],[26,16,17,8],[33,56,42,64],[34,38,57,62],[36,51,61,47],[41,46,50,54],[60,53,39,43],[35,45,63,52],[37,55,59,44],[58,48,49,40],[65,88,74,96],[66,70,89,94],[68,83,93,79],[73,78,82,86],[92,85,71,75],[67,77,95,84],[69,87,91,76],[90,80,81,72],[97,120,106,128],[98,102,121,126],[100,115,125,111],[105,110,114,118],[124,117,103,107],[99,109,127,116],[101,119,123,108],[122,112,113,104]],
            [[1,6,20,21],[2,31,7,10],[4,5,17,22],[24,28,14,19],[16,25,11,29],[3,8,12,30],[23,26,18,15],[9,27,13,32],[33,38,52,53],[34,63,39,42],[36,37,49,54],[56,60,46,51],[48,57,43,61],[35,40,44,62],[55,58,50,47],[41,59,45,64],[65,70,84,85],[66,95,71,74],[68,69,81,86],[88,92,78,83],[80,89,75,93],[67,72,76,94],[87,90,82,79],[73,91,77,96],[97,102,116,117],[98,127,103,106],[100,101,113,118],[120,124,110,115],[112,121,107,125],[99,104,108,126],[119,122,114,111],[105,123,109,128]],
            [[1,16,18,30],[2,14,17,32],[4,23,28,13],[27,31,19,21],[22,8,25,10],[3,5,11,15],[6,24,9,26],[20,7,12,29],[33,48,50,62],[34,46,49,64],[36,55,60,45],[59,63,51,53],[54,40,57,42],[35,37,43,47],[38,56,41,58],[52,39,44,61],[65,80,82,94],[66,78,81,96],[68,87,92,77],[91,95,83,85],[86,72,89,74],[67,69,75,79],[70,88,73,90],[84,71,76,93],[97,112,114,126],[98,110,113,128],[100,119,124,109],[123,127,115,117],[118,104,121,106],[99,101,107,111],[102,120,105,122],[116,103,108,125]],
            [[1,26,13,7],[2,9,21,15],[4,24,16,12],[23,17,10,29],[19,22,11,30],[3,6,27,14],[5,31,18,25],[28,20,8,32],[33,58,45,39],[34,41,53,47],[36,56,48,44],[55,49,42,61],[51,54,43,62],[35,38,59,46],[37,63,50,57],[60,52,40,64],[65,90,77,71],[66,73,85,79],[68,88,80,76],[87,81,74,93],[83,86,75,94],[67,70,91,78],[69,95,82,89],[92,84,72,96],[97,122,109,103],[98,105,117,111],[100,120,112,108],[119,113,106,125],[115,118,107,126],[99,102,123,110],[101,127,114,121],[124,116,104,128]],
            [[1,27,8,15],[2,13,22,12],[4,26,21,30],[6,28,18,29],[9,16,19,7],[3,23,25,32],[5,14,20,10],[24,31,17,11],[33,59,40,47],[34,45,54,44],[36,58,53,62],[38,60,50,61],[41,48,51,39],[35,55,57,64],[37,46,52,42],[56,63,49,43],[65,91,72,79],[66,77,86,76],[68,90,85,94],[70,92,82,93],[73,80,83,71],[67,87,89,96],[69,78,84,74],[88,95,81,75],[97,123,104,111],[98,109,118,108],[100,122,117,126],[102,124,114,125],[105,112,115,103],[99,119,121,128],[101,110,116,106],[120,127,113,107]]
        ]
    }
}

# ===== PŘíprava možností z SEATING_DEFINITIONS =====
available_keys = list(SEATING_DEFINITIONS.keys())
available_options = sorted(set((int(k.split('_')[0]), int(k.split('_')[1])) for k in available_keys))
grouped_by_group_size = {}
for p, g in available_options:
    grouped_by_group_size.setdefault(g, []).append(p)

# ===== Krok 1: Volba počtu hráčů a hry =====
if 'confirmed' not in st.session_state:
    st.session_state.confirmed = False

if not st.session_state.confirmed:
    col1, col2 = st.columns(2)
    with col1:
        group_size = st.radio("Počet hráčů u stolu", sorted(grouped_by_group_size.keys()), index=0, horizontal=True)
    with col2:
        # Add tournament type selection
        tournament_type = st.radio("Typ turnaje", ["UNIKÁTNÍ", "ŠVÝCARSKÝ SYSTÉM"], horizontal=True)
    col1, col2 = st.columns(2)  # Nový řádek se 2 sloupci
    with col1:
        if tournament_type == "UNIKÁTNÍ":
            player_options = grouped_by_group_size[group_size]
            players = st.selectbox("Počet hráčů", sorted(player_options))
        else:
            # Swiss system - generate multiples of group size
            if group_size == 3:
                min_players = 9
            else:  # group_size == 4
                min_players = 16
            player_options = list(range(min_players, 201, group_size))
            players = st.selectbox("Počet hráčů", player_options)
        
    with col2:
        if tournament_type == "UNIKÁTNÍ":
            key = f"{players}_{group_size}"
            max_rounds = len(SEATING_DEFINITIONS[key]["rounds"])
            rounds = st.selectbox("Počet kol", list(range(1, max_rounds + 1)))
        else:
            # Swiss system - fixed 1-15 rounds
            rounds = st.selectbox("Počet kol", list(range(1, 16)))
    
        vklad = st.number_input("Startovní vklad na hráče (Kč)", min_value=0, step=10)

    if st.button("Potvrdit údaje"):
        st.session_state.players = players
        st.session_state.rounds = rounds
        st.session_state.vklad = vklad
        st.session_state.group_size = group_size
        st.session_state.tournament_type = tournament_type
        st.session_state.confirmed = True
        st.rerun()
else:
    st.info(f"{st.session_state.players} hráčů, {st.session_state.rounds} kol, {st.session_state.group_size} u stolu, vklad {st.session_state.vklad} Kč, {st.session_state.tournament_type}")
    if st.button("🔁 Změnit údaje"):
        for k in ["confirmed", "players", "rounds", "vklad", "group_size", "player_names", "rozlosovani", "results", "finished", "current_round", "tournament_type", "player_scores"]:
            st.session_state.pop(k, None)
        st.rerun()

# ===== Krok 2: Zadání jmen hráčů =====
if st.session_state.confirmed and 'player_names' not in st.session_state:
    st.subheader("Zadejte jména hráčů")
    name_inputs = []
    col1, col2 = st.columns(2)
    for i in range(1, st.session_state.players + 1):
        with (col1 if i <= st.session_state.players / 2 else col2):
            name = st.text_input(f"Hráč {i}", value=f"Hráč {i}", key=f"name_{i}")
            name_inputs.append(name.strip())

    duplicates = {name for name, count in Counter(name_inputs).items() if count > 1}
    for name in duplicates:
        st.markdown(f"<span style='color:red;'>⚠️ Duplicitní jméno: {name}</span>", unsafe_allow_html=True)

    if not duplicates and st.button("Pokračovat"):
        st.session_state.player_names = name_inputs
        if st.session_state.tournament_type == "ŠVÝCARSKÝ SYSTÉM":
            # Initialize scores for Swiss system
            st.session_state.player_scores = {name: 0 for name in name_inputs}
        st.rerun()

# ===== Krok 3: Rozlosování =====
def generate_swiss_round(players, group_size, current_round, previous_results=None):
    """Generate pairings for a Swiss system round"""
    if current_round == 1:
        # First round - random pairings
        random.shuffle(players)
    else:
        # Subsequent rounds - sort by score and pair
        sorted_players = sorted(players, key=lambda x: st.session_state.player_scores[x], reverse=True)
        players = sorted_players
    
    groups = []
    for i in range(0, len(players), group_size):
        group = players[i:i+group_size]
        if len(group) == group_size:
            groups.append(group)
    
    # Handle leftover players by adding them to existing groups
    if len(players) % group_size != 0:
        leftovers = len(players) % group_size
        for i in range(leftovers):
            groups[i].append(players[-(i+1)])
    
    return groups

if 'player_names' in st.session_state and 'rozlosovani' not in st.session_state:
    if st.session_state.tournament_type == "UNIKÁTNÍ":
        key = f"{st.session_state.players}_{st.session_state.group_size}"
        raw_def = SEATING_DEFINITIONS[key]["rounds"][:st.session_state.rounds]
        schedule = []
        for rnd in raw_def:
            round_groups = []
            for group in rnd:
                group_filtered = [p for p in group if p <= st.session_state.players]
                if len(group_filtered) == len(group):
                    round_groups.append([st.session_state.player_names[p - 1] for p in group_filtered])
            schedule.append(round_groups)
        st.session_state.rozlosovani = schedule
    else:
        # Swiss system - generate first round
        first_round = generate_swiss_round(st.session_state.player_names.copy(), st.session_state.group_size, 1)
        st.session_state.rozlosovani = [first_round]
        # Initialize empty rounds for the rest
        for _ in range(1, st.session_state.rounds):
            st.session_state.rozlosovani.append([])

if 'rozlosovani' in st.session_state and 'results' not in st.session_state:
    st.subheader("📋 Rozlosování")
    for rnd_idx, rnd in enumerate(st.session_state.rozlosovani, 1):
        st.markdown(f"### Kolo {rnd_idx}")
        if rnd:  # Only show if round has pairings
            for table_idx, group in enumerate(rnd, 1):
                st.write(f"Stůl {table_idx}: {', '.join(group)}")
        else:
            st.write("(Rozlosování bude vygenerováno po zadání předchozího kola)")

    if st.button("Zadávat výsledky"):
        st.session_state.results = {}
        st.session_state.current_round = 1
        st.rerun()

# ===== Krok 4: Zadávání výsledků =====
if 'results' in st.session_state:
    rnd_idx = st.session_state.current_round
    schedule = st.session_state.rozlosovani
    
    # For Swiss system, generate next round if needed
    if st.session_state.tournament_type == "ŠVÝCARSKÝ SYSTÉM" and rnd_idx > 1 and len(schedule) >= rnd_idx and not schedule[rnd_idx-1]:
        next_round = generate_swiss_round(st.session_state.player_names.copy(), st.session_state.group_size, rnd_idx)
        st.session_state.rozlosovani[rnd_idx-1] = next_round
        schedule = st.session_state.rozlosovani
    
    st.subheader(f"✍️ Zadání výsledků – Kolo {rnd_idx}")
    round_data = []
    valid_round = True

    for table_idx, group in enumerate(schedule[rnd_idx - 1], 1):
        st.markdown(f"**Stůl {table_idx}: {', '.join(group)}**")
        sum_na_stole, sum_dokup = 0, 0
        table_entries = []

        for player in group:
            col1, col2 = st.columns(2)
            with col1:
                na_stole = st.number_input(f"{player} – na stole (Kč)", min_value=0, step=10, key=f"stole_{rnd_idx}_{table_idx}_{player}")
            with col2:
                dokup = st.number_input(f"{player} – dokup (Kč)", min_value=0, step=10, key=f"dokup_{rnd_idx}_{table_idx}_{player}")
            sum_na_stole += na_stole
            sum_dokup += dokup
            zisk = na_stole - st.session_state.vklad - dokup
            table_entries.append({"Hráč": player, "Na stole": na_stole, "Dokup": dokup, "Stůl": table_idx, "Kolo": rnd_idx, "Zisk": zisk})

        expected = st.session_state.vklad * len(group)
        diff = expected + sum_dokup - sum_na_stole
        if diff != 0:
            st.error(f"❌ Nesedí vklady: rozdíl {diff} Kč")
            valid_round = False
        else:
            st.success("✅ Vklady souhlasí")

        df_table = pd.DataFrame(table_entries)
        max_zisk = df_table["Zisk"].max()
        min_zisk = df_table["Zisk"].min()
        for _, row in df_table.iterrows():
            style = ""
            if row["Zisk"] == max_zisk:
                style = "color:green; font-weight:bold"
            elif row["Zisk"] == min_zisk:
                style = "color:red; font-weight:bold"
            st.markdown(f"<div style='{style}'>{row['Hráč']}: zisk {row['Zisk']} Kč</div>", unsafe_allow_html=True)
            
            # Update player scores for Swiss system
            if st.session_state.tournament_type == "ŠVÝCARSKÝ SYSTÉM":
                st.session_state.player_scores[row["Hráč"]] += row["Zisk"]

        round_data.extend(table_entries)

    all_rounds_preview = [entry for r in st.session_state.results.values() for entry in r] + round_data
    df_preview = pd.DataFrame(all_rounds_preview)
    df_preview = df_preview.groupby("Hráč")["Zisk"].sum().reset_index().sort_values(by="Zisk", ascending=False)

    if st.session_state.get("finished"):
        st.markdown("### 🏍️ Konečné pořadí")
    else:
        st.markdown("### 📈 Průběžné pořadí po tomto kole")

    st.dataframe(df_preview, use_container_width=True, hide_index=True)

    if st.button("📅 Uložit kolo a pokračovat"):
        if not valid_round:
            st.warning("Nelze uložit kolo, dokud nejsou vklady vyrovnané.")
        else:
            st.session_state.results[rnd_idx] = round_data
            if rnd_idx < st.session_state.rounds:
                st.session_state.current_round += 1
                st.rerun()
            else:
                st.success("🎉 Všechna kola byla zadána!")
                st.session_state.finished = True

# ===== Po posledním kole: souhrn kol a export =====
if st.session_state.get("finished") and "results" in st.session_state:
    st.subheader("📜 Výsledky všech kol")

    all_results = []
    for rnd_idx in range(1, st.session_state.rounds + 1):
        entries = st.session_state.results.get(rnd_idx, [])
        if not entries:
            continue

        st.markdown(f"### 🕒 Kolo {rnd_idx}")
        df = pd.DataFrame(entries)
        df["Zisk"] = df["Zisk"].astype(int)

        max_zisk = df["Zisk"].max()
        min_zisk = df["Zisk"].min()

        def color_zisk(val):
            if val == max_zisk:
                return "background-color: #d4f7d4; font-weight: bold"
            elif val == min_zisk:
                return "background-color: #fdd; font-weight: bold"
            return ""

        styled_df = df.style.applymap(color_zisk, subset=["Zisk"])
        st.dataframe(styled_df, use_container_width=True, hide_index=True)

        for e in entries:
            e["Kolo"] = rnd_idx
            all_results.append(e)

    df_all = pd.DataFrame(all_results)

    # Celkové zisky
    st.subheader("💰 Konečný zisk hráčů")
    total_zisky = df_all.groupby("Hráč")["Zisk"].sum().sort_values(ascending=False)
    for hrac, zisk in total_zisky.items():
        color = "green" if zisk > 0 else ("red" if zisk < 0 else "black")
        st.markdown(f"<span style='color:{color}; font-weight:bold'>{hrac}: {zisk:+} Kč</span>", unsafe_allow_html=True)

    # Export do CSV
    import io
    csv_buffer = io.BytesIO()
    csv_content = df_all.to_csv(index=False, sep=";", encoding="cp1250")
    csv_buffer.write(csv_content.encode("cp1250"))
    csv_buffer.seek(0)
    df_all.to_csv(csv_buffer, index=False, sep=";", encoding="iso-8859-2")
    
    st.download_button(
        label="📅 Stáhnout výsledky jako CSV",
        data=csv_buffer,
        file_name="vysledky_marias.csv",
        mime="text/csv"
    )

    # Export HTML pro tisk/PDF
    import tempfile, base64
    html_output = "<h2>Výsledky mariášového turnaje</h2>"
    for rnd_idx in range(1, st.session_state.rounds + 1):
        entries = st.session_state.results.get(rnd_idx, [])
        if not entries:
            continue
        html_output += f"<h3>Kolo {rnd_idx}</h3><table border='1' cellspacing='0' cellpadding='4'><tr><th>Hráč</th><th>Na stole</th><th>Dokup</th><th>Zisk</th></tr>"
        df = pd.DataFrame(entries)
        max_zisk = df["Zisk"].max()
        min_zisk = df["Zisk"].min()
        for _, row in df.iterrows():
            style = ""
            if row["Zisk"] == max_zisk:
                style = " style='background-color:#d4f7d4; font-weight:bold'"
            elif row["Zisk"] == min_zisk:
                style = " style='background-color:#fdd; font-weight:bold'"
            html_output += f"<tr{style}><td>{row['Hráč']}</td><td>{row['Na stole']}</td><td>{row['Dokup']}</td><td>{row['Zisk']}</td></tr>"
        html_output += "</table><br>"

    html_output += "<h3>Konečný zisk hráčů</h3><ul>"
    for hrac, zisk in total_zisky.items():
        color = "green" if zisk > 0 else ("red" if zisk < 0 else "black")
        html_output += f"<li><span style='color:{color}; font-weight:bold'>{hrac}: {zisk:+} Kč</span></li>"
    html_output += "</ul>"

    with tempfile.NamedTemporaryFile("w", delete=False, suffix=".html", encoding="utf-8") as f:
        f.write(html_output)
        html_path = f.name

    with open(html_path, "r", encoding="utf-8") as f:
        html_data = f.read()

    st.download_button(
        label="🖊️ Stáhnout výsledky jako HTML (pro tisk nebo PDF)",
        data=html_data,
        file_name="vysledky_turnaje.html",
        mime="text/html"
    )
